<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë³´ì²˜ë¦¬ì‚°ì—…ê¸°ì‚¬ ê³¼ì •í‰ê°€í˜• CBT</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root { --primary: #2563eb; --light: #eff6ff; --correct: #22c55e; --wrong: #ef4444; --text: #1f2937; }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif; margin: 0; padding: 0; background-color: #f3f4f6; color: var(--text); display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 600px; background: white; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); min-height: 100vh; display: flex; flex-direction: column; position: relative; }
        
        /* í™”ë©´ ì „í™˜ìš© */
        .screen { display: none; flex-direction: column; height: 100%; }
        .active { display: flex; }

        /* ê³µí†µ í—¤ë” */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; position: relative; }
        .home-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280; padding: 5px; }
        .timer-badge { background: #fee2e2; color: #991b1b; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 14px; display: none; }

        /* ë©”ì¸ í™”ë©´ */
        h1 { text-align: center; color: var(--primary); margin-bottom: 10px; font-size: 24px; }
        .desc { text-align: center; color: #666; margin-bottom: 30px; font-size: 14px; }
        
        /* ë²„íŠ¼ ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ (ê°„ê²© ìˆ˜ì •ë¨) */
        #subject-list { display: flex; flex-direction: column; gap: 12px; } /* ê°„ê²© 12px ì¶”ê°€ */
        
        .subject-btn { background: white; border: 1px solid #d1d5db; padding: 16px; border-radius: 12px; font-size: 16px; cursor: pointer; transition: 0.2s; text-align: left; font-weight: bold; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .subject-btn:hover { background: var(--light); border-color: var(--primary); color: var(--primary); transform: translateY(-2px); }
        
        /* ì‹¤ì „ ëª¨ì˜ê³ ì‚¬ ë²„íŠ¼ (ê°•ì¡°) */
        .mock-exam-btn { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; border: none; padding: 18px; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3); text-align: center; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .mock-exam-btn:hover { transform: scale(1.02); }

        /* í€´ì¦ˆ í™”ë©´ */
        .status-bar { display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: bold; color: #6b7280; font-size: 14px; }
        .question-box { font-size: 19px; font-weight: bold; margin-bottom: 30px; line-height: 1.6; word-break: keep-all; }
        
        .option-btn { display: block; width: 100%; padding: 16px; margin-bottom: 10px; border: 1px solid #d1d5db; border-radius: 12px; background: white; font-size: 16px; cursor: pointer; text-align: left; transition: 0.2s; line-height: 1.4; }
        .option-btn:hover { background: var(--light); border-color: var(--primary); }
        
        .input-box { width: 100%; padding: 15px; font-size: 16px; border: 2px solid #d1d5db; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; }
        .submit-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }

        /* í”¼ë“œë°± */
        .feedback { margin-top: 20px; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; display: none; line-height: 1.5; }
        .feedback.correct { background: #dcfce7; color: #166534; }
        .feedback.wrong { background: #fee2e2; color: #991b1b; }
        .next-btn { margin-top: 15px; width: 100%; padding: 15px; background: #374151; color: white; border: none; border-radius: 8px; cursor: pointer; display: none; font-size: 16px; }

        /* ê²°ê³¼ í™”ë©´ */
        .result-container { padding: 10px; background: white; border-radius: 10px; }
        .result-score { font-size: 42px; font-weight: bold; text-align: center; color: var(--primary); margin: 20px 0; }
        
        /* ë¶„ì„ í…Œì´ë¸” */
        .analysis-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; }
        .analysis-table th, .analysis-table td { border: 1px solid #e5e7eb; padding: 10px; text-align: center; }
        .analysis-table th { background-color: #f9fafb; font-weight: bold; color: #4b5563; }
        .analysis-table td { color: #1f2937; }
        .low-score { color: #ef4444; font-weight: bold; }
        
        .restart-btn { padding: 15px; background: #4b5563; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 100%; margin-top: 10px; }
        .capture-btn { padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 100%; margin-top: 10px; margin-bottom: 10px;}

        /* ìœ í‹¸ë¦¬í‹° */
        .hidden { display: none; }

        /* [ì‹ ê·œ] í•˜ë‹¨ ê³µì§€ì‚¬í•­ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .notice-box {
            margin-top: 30px;
            background-color: #f8fafc; /* ì—°í•œ íšŒìƒ‰/í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            font-size: 14px;
            color: #475569;
            line-height: 1.6;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);
        }
        .notice-box h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #1e40af; /* ì§„í•œ íŒŒë€ìƒ‰ ì œëª© */
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .notice-box ul {
            margin: 0;
            padding-left: 20px;
        }
        .notice-box li {
            margin-bottom: 6px;
        }
        .notice-box strong {
            color: #b91c1c; /* ê°•ì¡°ìƒ‰ (ë¹¨ê°•) */
        }
    </style>
</head>
<body>

<div class="container" id="main-container">
    <div id="screen-home" class="screen active">
        <h1 style="margin-top: 20px;">ì •ë³´ì²˜ë¦¬ì‚°ì—…ê¸°ì‚¬<br>í•„ê¸° í•µì‹¬ìš”ì•½ CBT</h1>
        <p class="desc">ëŠ¥ë ¥ë‹¨ìœ„ë³„ í•™ìŠµ ë° ì‹¤ì „ ëª¨ì˜ê³ ì‚¬</p>
        
        <button class="mock-exam-btn" onclick="startMockExam()">
            <span>â° ì‹¤ì „ëŒ€ë¹„ ë¬¸ì œí’€ì´ (45ë¬¸ì œ)</span>
        </button>

        <div style="font-size: 14px; font-weight: bold; color: #4b5563; margin-bottom: 10px;">ëŠ¥ë ¥ë‹¨ìœ„ë³„ í•™ìŠµí•˜ê¸°</div>
        <div id="subject-list"></div>

        <div class="notice-box">
            <h3>ğŸ“¢ ì•Œë¦¼ ë° ìœ ì˜ì‚¬í•­</h3>
            <ul>
                <li>ğŸ† <strong>ë­í‚¹ ì‹œìŠ¤í…œ</strong>ì´ ê³§ ë„ì…ë  ì˜ˆì •ì…ë‹ˆë‹¤! ì¹œêµ¬ë“¤ê³¼ ì ìˆ˜ ëŒ€ê²°ì„ ê¸°ëŒ€í•´ ì£¼ì„¸ìš”.</li>
                <li>ğŸ“š ì œê³µë˜ëŠ” [ìš”ì•½] ë‚´ìš©ì€ í•µì‹¬ ì‚¬í•­ ìœ„ì£¼ë¡œ ì •ë¦¬ëœ ê²ƒì…ë‹ˆë‹¤.</li>
                <li>ğŸ’¯ ê³ ë“ì ì„ ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ <strong>NCS í•™ìŠµëª¨ë“ˆ ì›ë¬¸</strong>ì„ í•¨ê»˜ ì°¸ê³ í•˜ì—¬ ê¹Šì´ ìˆê²Œ ê³µë¶€í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</li>
                <li>ğŸ£ ì•„ì§ ì´ˆê¸° ë²„ì „ì´ì—ìš”! ì´ìš© ì¤‘ ë¬¸ì œë‚˜ ì˜¤íƒ€ë¥¼ ë°œê²¬í•˜ë©´ ì„ ìƒë‹˜ê»˜ ê¼­ ì•Œë ¤ì£¼ì„¸ìš”. ì—¬ëŸ¬ë¶„ì˜ ì œë³´ê°€ í° í˜ì´ ë©ë‹ˆë‹¤!</li>
            </ul>
        </div>
    </div>

    <div id="screen-quiz" class="screen">
        <div class="header">
            <button class="home-btn" onclick="confirmHome()" title="ì²˜ìŒìœ¼ë¡œ">ğŸ </button>
            <div id="timer-badge" class="timer-badge">ë‚¨ì€ ì‹œê°„ 20:00</div>
        </div>
        
        <div class="status-bar">
            <span id="subject-title" style="font-weight: normal; color: var(--primary);">ê³¼ëª©ëª…</span>
            <span id="progress-text">1 / 50</span>
        </div>
        <div class="question-box" id="question-text">ë¬¸ì œ ë‚´ìš©</div>
        
        <div id="options-area"></div>
        
        <div id="short-area" class="hidden">
            <input type="text" id="short-input" class="input-box" placeholder="ì •ë‹µ ì…ë ¥ (ë„ì–´ì“°ê¸° ë¬´ê´€)">
            <button class="submit-btn" onclick="checkShortAnswer()">ì œì¶œí•˜ê¸°</button>
        </div>

        <div id="feedback" class="feedback"></div>
        <button id="next-btn" class="next-btn" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ âœ</button>
    </div>

    <div id="screen-result" class="screen">
        <div class="result-container" id="capture-area">
            <h1 style="margin-bottom: 5px;">ì‹œí—˜ ê²°ê³¼ ë¶„ì„</h1>
            <p style="text-align: center; color: #666; margin-top: 0;" id="result-subtitle">ê³¼ëª©ë³„ ì ìˆ˜ í™•ì¸</p>
            
            <div class="result-score" id="final-score">0ì </div>
            <div style="text-align: center; margin-bottom: 20px; font-weight: bold;" id="result-msg"></div>

            <table class="analysis-table" id="analysis-table">
                <thead>
                    <tr>
                        <th>ëŠ¥ë ¥ë‹¨ìœ„ (ê³¼ëª©)</th>
                        <th>ë§ì€ ê°œìˆ˜</th>
                    </tr>
                </thead>
                <tbody id="analysis-body">
                    </tbody>
            </table>
            <p style="text-align: center; font-size: 12px; color: #999;">* ë³¸ ê²°ê³¼í‘œëŠ” ê°œì¸ ë¶„ì„ìš©ìœ¼ë¡œ í™œìš©í•˜ì„¸ìš”.</p>
        </div>

        <button class="capture-btn" onclick="captureResult()">ğŸ“¸ ê²°ê³¼ í™”ë©´ ìº¡ì²˜(ì €ì¥)</button>
        <button class="restart-btn" onclick="goHome()">ğŸ  ì²˜ìŒ í™”ë©´ìœ¼ë¡œ</button>
    </div>
</div>

<script src="quizData.js"></script>

<script>
    /* =========================================
       ì „ì—­ ë³€ìˆ˜
       ========================================= */
    let currentMode = "study"; // 'study' (ë‹¨ê³¼ëª©) or 'mock' (ëª¨ì˜ê³ ì‚¬)
    let currentQuestions = []; // í˜„ì¬ í’€ ë¬¸ì œ ë¦¬ìŠ¤íŠ¸
    let currentIndex = 0;
    let score = 0;
    let isAnswered = false;
    
    // ëª¨ì˜ê³ ì‚¬ìš© ë³€ìˆ˜
    let mockScores = {}; // ê³¼ëª©ë³„ ì ìˆ˜ ì €ì¥ìš© { "ê³¼ëª©ëª…": 0 }
    let timerInterval = null;
    const TIME_LIMIT_MIN = 20;

    /* =========================================
       ì´ˆê¸°í™” ë° ë„¤ë¹„ê²Œì´ì…˜
       ========================================= */
/* =========================================
   [ìˆ˜ì •] ìƒì„¸ í•™ìŠµ ë‚´ìš©(sub*.html) ì—°ë™
   ========================================= */
function init() {
    const list = document.getElementById('subject-list');
    list.innerHTML = "";
    
    // ê³¼ëª©ëª…ê³¼ íŒŒì¼ëª… ë§µí•‘ (1~9)
    const fileMap = {
        "1.ì‘ìš©SWê¸°ì´ˆê¸°ìˆ í™œìš©": "sub1.html",
        "2.ê°œë°œìí™˜ê²½êµ¬ì¶•": "sub2.html",
        "3.í”„ë¡œê·¸ë˜ë°ì–¸ì–´í™œìš©": "sub3.html",
        "4.í”„ë¡œê·¸ë˜ë°ì–¸ì–´ì‘ìš©": "sub4.html",
        "5.ì• í”Œë¦¬ì¼€ì´ì…˜í…ŒìŠ¤íŠ¸ìˆ˜í–‰": "sub5.html",
        "6.í™”ë©´êµ¬í˜„": "sub6.html",
        "7.ì• í”Œë¦¬ì¼€ì´ì…˜ë°°í¬": "sub7.html",
        "8.SQLí™œìš©": "sub8.html",
        "9.UIí…ŒìŠ¤íŠ¸": "sub9.html"
    };

    if (typeof quizDatabase !== 'undefined') {
        Object.keys(quizDatabase).forEach(subject => {
            // 1. ê°€ë¡œì¤„ ì»¨í…Œì´ë„ˆ
            const row = document.createElement('div');
            row.className = 'subject-row';
            row.style.display = 'flex';
            row.style.gap = '8px';

            // 2. ì™¼ìª½: ë¬¸ì œ í’€ê¸° ë²„íŠ¼
            const quizBtn = document.createElement('button');
            quizBtn.className = 'subject-btn';
            quizBtn.style.flex = '1'; // ë„ˆë¹„ ê½‰ ì±„ìš°ê¸°
            quizBtn.innerText = subject;
            quizBtn.onclick = () => startStudyMode(subject);

            // 3. ì˜¤ë¥¸ìª½: ë‚´ìš© ë³´ê¸° ë²„íŠ¼ (ìƒˆ ì°½ ì—´ê¸°)
            const studyBtn = document.createElement('a');
            studyBtn.href = fileMap[subject] || "#"; 
            studyBtn.target = "_blank"; // ìƒˆ ì°½ìœ¼ë¡œ ì—´ê¸°
            studyBtn.style.cssText = "width: 70px; background: #fff7ed; border: 1px solid #fdba74; border-radius: 8px; color: #c2410c; font-weight: bold; font-size: 13px; text-decoration: none; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;";
            
            studyBtn.innerHTML = `
                <span style="font-size: 18px; margin-bottom: 2px;">ğŸ“š</span>
                <span>ì´ë¡ </span>
            `;

            row.appendChild(quizBtn);
            row.appendChild(studyBtn);
            list.appendChild(row);
        });
    }
}

    // í™ˆìœ¼ë¡œ ê°€ê¸° (í™•ì¸ ì ˆì°¨)
    function confirmHome() {
        if (confirm("ì‹œí—˜ì„ ì¤‘ë‹¨í•˜ê³  ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì§„í–‰ ìƒí™©ì€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)")) {
            stopTimer();
            goHome();
        }
    }

    function goHome() {
        switchScreen('screen-home');
        init();
    }

    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0, 0);
    }

    /* =========================================
       [ëª¨ë“œ 1] ë‹¨ê³¼ëª© í•™ìŠµ ëª¨ë“œ
       ========================================= */
    function startStudyMode(subject) {
        currentMode = "study";
        currentQuestions = [...quizDatabase[subject]]; // ë³µì‚¬
        
        // ë¬¸ì œ ì„ê¸° ì›í•˜ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ
        // currentQuestions.sort(() => Math.random() - 0.5); 

        // ë°ì´í„° ì •ê·œí™” (ê³¼ëª©ëª… íƒœê¹…)
        currentQuestions.forEach(q => q._subject = subject);

        resetQuizState();
        document.getElementById('subject-title').innerText = subject;
        document.getElementById('timer-badge').style.display = 'none';
        
        switchScreen('screen-quiz');
        loadQuestion();
    }

    /* =========================================
       [ëª¨ë“œ 2] ì‹¤ì „ ëª¨ì˜ê³ ì‚¬ (45ë¬¸ì œ, 20ë¶„)
       ========================================= */
    function startMockExam() {
        currentMode = "mock";
        currentQuestions = [];
        mockScores = {};

        // 1. ê° ê³¼ëª©ë³„ë¡œ 5ë¬¸ì œì”© ëœë¤ ì¶”ì¶œ
        const subjects = Object.keys(quizDatabase);
        subjects.forEach(subject => {
            mockScores[subject] = 0; // ì ìˆ˜ ì´ˆê¸°í™”
            const pool = [...quizDatabase[subject]];
            // ëœë¤ ì…”í”Œ
            pool.sort(() => Math.random() - 0.5);
            // 5ê°œ ì¶”ì¶œ
            const selected = pool.slice(0, 5);
            // ê³¼ëª©ëª… íƒœê¹… (ê²°ê³¼ ë¶„ì„ìš©)
            selected.forEach(q => q._subject = subject);
            
            currentQuestions.push(...selected);
        });

        // 2. ì „ì²´ ë¬¸ì œ ìˆœì„œëŠ” ê³¼ëª© ìˆœì„œëŒ€ë¡œ í• ì§€, ì™„ì „ ì„ì„ì§€ ê²°ì • (ì—¬ê¸°ì„  ê³¼ëª©ë³„ ë¬¶ìŒ ìœ ì§€)
        // ë§Œì•½ ì „ì²´ë¥¼ ì„ê³  ì‹¶ë‹¤ë©´: currentQuestions.sort(() => Math.random() - 0.5);

        if (currentQuestions.length === 0) {
            alert("ë¬¸ì œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        resetQuizState();
        document.getElementById('subject-title').innerText = "ì‹¤ì „ ëª¨ì˜ê³ ì‚¬";
        
        // íƒ€ì´ë¨¸ ì‹œì‘
        document.getElementById('timer-badge').style.display = 'block';
        startTimer(TIME_LIMIT_MIN * 60);

        switchScreen('screen-quiz');
        loadQuestion();
    }

    function resetQuizState() {
        currentIndex = 0;
        score = 0;
        isAnswered = false;
    }

    /* =========================================
       íƒ€ì´ë¨¸ ë¡œì§
       ========================================= */
    function startTimer(durationSeconds) {
        stopTimer();
        let timer = durationSeconds;
        const display = document.getElementById('timer-badge');
        
        updateTimerDisplay(timer, display);

        timerInterval = setInterval(function () {
            timer--;
            updateTimerDisplay(timer, display);

            if (timer <= 0) {
                stopTimer();
                alert("ì‹œí—˜ ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.");
                showResult();
            }
        }, 1000);
    }

    function updateTimerDisplay(seconds, displayElement) {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        displayElement.innerText = `ë‚¨ì€ ì‹œê°„ ${m}:${s < 10 ? '0' + s : s}`;
        
        // 1ë¶„ ë¯¸ë§Œì¼ ë•Œ ë¹¨ê°„ìƒ‰ ê°•ì¡°
        if (seconds < 60) displayElement.style.background = "#ef4444";
        else displayElement.style.background = "#fee2e2";
        displayElement.style.color = seconds < 60 ? "white" : "#991b1b";
    }

    function stopTimer() {
        if (timerInterval) clearInterval(timerInterval);
    }

    /* =========================================
       ë¬¸ì œ ë¡œë“œ ë° ì •ë‹µ ì²˜ë¦¬
       ========================================= */
    function loadQuestion() {
        isAnswered = false;
        const qData = currentQuestions[currentIndex];
        
        document.getElementById('progress-text').innerText = `${currentIndex + 1} / ${currentQuestions.length}`;
        document.getElementById('question-text').innerText = `Q. ${qData.q}`;
        
        // í”¼ë“œë°± ì´ˆê¸°í™”
        const feedback = document.getElementById('feedback');
        feedback.style.display = 'none';
        feedback.className = 'feedback';
        document.getElementById('next-btn').style.display = 'none';

        // UI ë Œë”ë§
        const optsArea = document.getElementById('options-area');
        const shortArea = document.getElementById('short-area');
        const shortInput = document.getElementById('short-input');

        optsArea.innerHTML = "";
        shortInput.value = "";

        if (qData.type === 'choice') {
            shortArea.classList.add('hidden');
            optsArea.classList.remove('hidden');
            qData.o.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, qData); // ê°ì²´ ì „ì²´ ì „ë‹¬
                optsArea.appendChild(btn);
            });
        } else {
            optsArea.classList.add('hidden');
            shortArea.classList.remove('hidden');
        }
    }

    function checkAnswer(userAnswer, qData) {
        if (isAnswered) return;
        isAnswered = true;
        
        const feedback = document.getElementById('feedback');
        feedback.style.display = 'block';
        
        const isCorrect = (userAnswer === qData.a);
        
        if (isCorrect) {
            score++;
            // ëª¨ì˜ê³ ì‚¬ ëª¨ë“œì¼ ê²½ìš° ê³¼ëª©ë³„ ì ìˆ˜ ê¸°ë¡
            if (currentMode === "mock") {
                mockScores[qData._subject]++;
            }
            feedback.innerText = "ì •ë‹µì…ë‹ˆë‹¤! â­•";
            feedback.classList.add('correct');
        } else {
            feedback.innerHTML = `ì˜¤ë‹µì…ë‹ˆë‹¤ âŒ<br>ì •ë‹µ: <span style="color:#d97706">${qData.a}</span>`;
            feedback.classList.add('wrong');
        }
        document.getElementById('next-btn').style.display = 'block';
    }

    function checkShortAnswer() {
        if (isAnswered) return;
        
        const input = document.getElementById('short-input');
        const userVal = input.value.trim().replace(/\s+/g, '').toLowerCase();
        const qData = currentQuestions[currentIndex];
        const correctVal = qData.a.trim().replace(/\s+/g, '').toLowerCase();

        if (userVal === "") {
            alert("ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        // ì£¼ê´€ì‹ë„ checkAnswer ë¡œì§ê³¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ í˜¸ì¶œ
        // ë‹¨, userValê³¼ correctVal ë¹„êµëŠ” ì—¬ê¸°ì„œ ìˆ˜í–‰í•˜ì§€ë§Œ, 
        // í¸ì˜ìƒ checkAnswer í•¨ìˆ˜ë¥¼ ì•½ê°„ ìˆ˜ì •í•˜ê±°ë‚˜ ì§ì ‘ ë¡œì§ êµ¬í˜„
        
        isAnswered = true;
        const feedback = document.getElementById('feedback');
        feedback.style.display = 'block';

        if (userVal === correctVal) {
            score++;
            if (currentMode === "mock") mockScores[qData._subject]++;
            feedback.innerText = "ì •ë‹µì…ë‹ˆë‹¤! â­•";
            feedback.classList.add('correct');
        } else {
            feedback.innerHTML = `ì˜¤ë‹µì…ë‹ˆë‹¤ âŒ<br>ì •ë‹µ: <span style="color:#d97706">${qData.a}</span>`;
            feedback.classList.add('wrong');
        }
        document.getElementById('next-btn').style.display = 'block';
    }


    function nextQuestion() {
        currentIndex++;
        if (currentIndex < currentQuestions.length) {
            loadQuestion();
        } else {
            stopTimer(); // ì‹œí—˜ ì¢…ë£Œ ì‹œ íƒ€ì´ë¨¸ ì •ì§€
            showResult();
        }
    }

    /* =========================================
       ê²°ê³¼ í™”ë©´ ë° ìº¡ì²˜
       ========================================= */
    function showResult() {
        switchScreen('screen-result');
        
        const finalScore = document.getElementById('final-score');
        const resultMsg = document.getElementById('result-msg');
        const tbody = document.getElementById('analysis-body');
        const subTitle = document.getElementById('result-subtitle');
        
        tbody.innerHTML = ""; // í…Œì´ë¸” ì´ˆê¸°í™”

        if (currentMode === "study") {
            // ë‹¨ê³¼ëª© ëª¨ë“œ
            subTitle.innerText = "ë‹¨ì›ë³„ í•™ìŠµ ê²°ê³¼";
            const convertedScore = Math.round((score / currentQuestions.length) * 100);
            finalScore.innerText = `${convertedScore}ì `;
            resultMsg.innerText = `${currentQuestions.length}ë¬¸ì œ ì¤‘ ${score}ë¬¸ì œ ì •ë‹µ`;
            
            // í…Œì´ë¸” ìˆ¨ê¸°ê±°ë‚˜ ê°„ë‹¨íˆ í‘œì‹œ
            document.getElementById('analysis-table').style.display = 'none';

        } else {
            // ëª¨ì˜ê³ ì‚¬ ëª¨ë“œ
            subTitle.innerText = "ì‹¤ì „ ëª¨ì˜ê³ ì‚¬ ë¶„ì„í‘œ";
            document.getElementById('analysis-table').style.display = 'table';
            
            // ì´ì  ê³„ì‚° (100ì  ë§Œì  í™˜ì‚°: 45ë¬¸ì œ ì¤‘ ë§ì€ ê°œìˆ˜ * 2.22... í˜¹ì€ ê·¸ëƒ¥ ê°œìˆ˜ í‘œì‹œ)
            // ì‚°ì—…ê¸°ì‚¬ëŠ” ê³¼ëª©ë‹¹ 20ë¬¸ì œì§€ë§Œ ì—¬ê¸°ì„  ì•½ì‹ì´ë¯€ë¡œ 100ì  ë§Œì ìœ¼ë¡œ ë‹¨ìˆœ í™˜ì‚°
            const totalScore = Math.round((score / 45) * 100);
            finalScore.innerText = `ì´ì : ${totalScore}ì `;
            
            let msg = "";
            if (totalScore >= 60) msg = "í•©ê²© ê°€ëŠ¥ê¶Œì…ë‹ˆë‹¤! ğŸ‰";
            else msg = "ì¡°ê¸ˆ ë” ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤. ğŸ”¥";
            resultMsg.innerText = msg;

            // ê³¼ëª©ë³„ ë¶„ì„ í…Œì´ë¸” ìƒì„±
            const subjects = Object.keys(mockScores);
            subjects.forEach(subj => {
                const correctCount = mockScores[subj];
                const tr = document.createElement('tr');
                
                // ê³¼ëª©ëª… ì•ì˜ ìˆ«ì(1. 2...) ì œê±°í•˜ê³  ê¹”ë”í•˜ê²Œ í‘œì‹œ
                const cleanSubjName = subj.replace(/^\d+\./, ''); 
                
                let countHtml = `${correctCount} / 5`;
                if (correctCount <= 2) {
                    countHtml = `<span class="low-score">${countHtml} (ë³´ì¶© í•„ìš”)</span>`;
                }

                tr.innerHTML = `
                    <td style="text-align:left;">${cleanSubjName}</td>
                    <td>${countHtml}</td>
                `;
                tbody.appendChild(tr);
            });
        }
    }

    // ê²°ê³¼ í™”ë©´ ìº¡ì²˜ ê¸°ëŠ¥
    function captureResult() {
        const captureArea = document.getElementById('capture-area');
        
        html2canvas(captureArea).then(canvas => {
            // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
            const link = document.createElement('a');
            link.download = 'ì‹œí—˜ê²°ê³¼_ë¶„ì„í‘œ.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    // ì•± ì‹œì‘
    init();

</script>
</body>
</html>
