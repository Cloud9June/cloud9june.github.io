<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì„±ì¼ì •ë³´ê³  í•©ê²©ì ì¡°íšŒ</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
    }

    body {
      margin: 0;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      width: 100%;
      padding: 25px 20px 30px;
      text-align: center;
    }

    h1 {
      font-size: 1.3rem;
      margin-bottom: 10px;
      color: #0d47a1;
    }

    label {
      display: block;
      text-align: left;
      margin-top: 15px;
      font-size: 0.9rem;
      color: #333;
      font-weight: 500;
    }

    input,
    select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 0.95rem;
    }

    button {
      width: 100%;
      margin-top: 20px;
      padding: 12px;
      background-color: #0d47a1;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background-color: #1565c0;
    }

    .result {
      display: none;
      flex-direction: column;
      align-items: center;
    }

    .card {
      width: 320px;
      height: 440px;
      background: #fff;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      position: relative;
    }

    .side {
      position: absolute;
      left: 0;
      top: 0;
      width: 70px;
      height: 100%;
      overflow: hidden;
      border-top-left-radius: 15px;
      border-bottom-left-radius: 15px;
    }

    .photo {
      position: absolute;
      top: 20px;
      left: 90px;
      width: 200px;
      height: 210px;
      border-radius: 10px;
      border: 2px solid #0d47a1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      /* âœ… ë°°ê²½ìƒ‰ ì œê±° */
      cursor: pointer;
      overflow: hidden;
    }

    #photoPreview {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    .camera-btn {
      background: none;
    }

    .camera-btn:hover {
      background: none;
    }

    .camera-btn img {
      width: 90px;
      height: 90px;
      object-fit: contain;
      /* âœ… ë¹„ìœ¨ ìœ ì§€ */
      aspect-ratio: 1 / 1;
      /* âœ… ê°€ë¡œì„¸ë¡œ ë¹„ìœ¨ ê³ ì • */
      opacity: 0.9;
    }

    .camera-hint {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #555;
      text-align: center;
      line-height: 1.3;
    }

    .info {
      position: absolute;
      top: 250px;
      left: 90px;
      width: 200px;
    }

    .info-line {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      margin-bottom: 12px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 4px;
    }

    .info-line span.label {
      color: #999;
      font-weight: 500;
    }

    .info-line span.value {
      color: #0d47a1;
      font-weight: 700;
    }

    .congrats {
      position: absolute;
      bottom: 20px;
      right: 23px;
      width: 100%;
      text-align: right;
      color: #e53935;
      font-weight: 700;
      font-size: 1.1rem;
    }

    .save-btn {
      margin-top: 20px;
      background-color: #e53935;
      color: #fff;
      font-size: 1rem;
      padding: 10px 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    #confetti {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
  </style>
</head>

<body>

  <!-- ì…ë ¥ í¼ -->
  <div class="container" id="formBox">
    <h1>ì„±ì¼ì •ë³´ê³  í•©ê²©ì ì¡°íšŒ</h1>

    <label for="school">ì¤‘í•™êµ</label>
    <select id="school">
      <option value="">ì„ íƒí•˜ì„¸ìš”</option>
    </select>

    <!-- âœ… ë°˜ ì„ íƒ -->
    <label for="classSelect">ë°˜</label>
    <select id="classSelect">
      <option value="">ì„ íƒí•˜ì„¸ìš”</option>
    </select>

    <!-- âœ… ë²ˆí˜¸ ì„ íƒ -->
    <label for="numberSelect">ë²ˆí˜¸</label>
    <select id="numberSelect">
      <option value="">ì„ íƒí•˜ì„¸ìš”</option>
    </select>

    <label for="studentName">ì´ë¦„</label>
    <input type="text" id="studentName" placeholder="ì˜ˆ: í™ê¸¸ë™" />

    <label for="department">ì§€ì›í•™ê³¼</label>
    <select id="department">
      <option value="">ì„ íƒí•˜ì„¸ìš”</option>
      <option>ë·°í‹°ë””ìì¸ê³¼</option>
      <option>ë¶€ì‚¬ê´€ê³¼</option>
      <option>ê¸€ë¡œë²Œê²½ì˜ê³¼</option>
      <option>íšŒê³„ì •ë³´ê³¼</option>
      <option>ì°½ì—…ë§ˆì¼€íŒ…ê³¼</option>
      <option>AIê²Œì„ì½˜í…ì¸ ê³¼</option>
      <option>ì†Œí”„íŠ¸ì›¨ì–´ê°œë°œê³¼</option>
    </select>

    <button onclick="checkResult()">í•©ê²©ì í™•ì¸</button>
  </div>

  <!-- ê²°ê³¼ -->
  <div class="result" id="resultBox">
    <div class="card" id="cardArea">
      <div class="side">
        <svg xmlns="http://www.w3.org/2000/svg" width="70" height="440" viewBox="0 0 70 440">
          <rect width="70" height="440" fill="#0d47a1" />
          <style>
            text {
              font-family: Pretendard, sans-serif;
              font-weight: 700;
              fill: white;
              font-size: 20px;
            }
          </style>
          <text x="35" y="225" transform="rotate(90,35,220)" text-anchor="middle">
            SUNGIL INFORMATION HIGH SCHOOL
          </text>
        </svg>
      </div>

      <div class="photo" id="photoArea">
        <img id="photoPreview" alt="í•™ìƒ ì‚¬ì§„">
        <input type="file" id="photoInput" accept="image/*" style="display:none">
        <button class="camera-btn" id="cameraButton" onclick="openCamera()">
          <img src="./camera.png" alt="ì‚¬ì§„ ì—…ë¡œë“œ">
          <div class="camera-hint" id="cameraHint">ì¹´ë©”ë¼ ë²„íŠ¼ì„ ëˆŒëŸ¬<br>ë‚˜ì˜ ì‚¬ì§„ì„ ì˜¬ë ¤ë³´ì„¸ìš”</div>
        </button>
      </div>

      <div class="info">
        <div class="info-line"><span class="label">í•™êµ</span><span class="value">ì„±ì¼ì •ë³´ê³ ë“±í•™êµ</span></div>
        <div class="info-line"><span class="label">í•™ê³¼</span><span class="value" id="deptValue"></span></div>
        <div class="info-line"><span class="label">ì´ë¦„</span><span class="value" id="nameValue"></span></div>
      </div>

      <div class="congrats">í•©ê²©ì„ ì§„ì‹¬ìœ¼ë¡œ<br>ì¶•í•˜í•©ë‹ˆë‹¤</div>
    </div>

    <button class="save-btn" onclick="saveCard()">ğŸ“¥ ìº¡ì²˜í•˜ê¸°</button>
  </div>

  <canvas id="confetti"></canvas>

  <script src="data.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    // âœ… ì¤‘í•™êµ ëª©ë¡
    const middleSchools = [
      'ê²½ì•ˆì¤‘í•™êµ', 'ê²½í™”ì—¬ìì¤‘í•™êµ', 'ê³¤ì§€ì•”ì¤‘í•™êµ', 'ê´‘ì£¼ê´‘ë‚¨ì¤‘í•™êµ', 'ê´‘ì£¼ì¤‘í•™êµ',
      'ê¸ˆê´‘ì¤‘í•™êµ', 'ëŒ€ì›ì¤‘í•™êµ', 'ë„ì´Œì¤‘í•™êµ', 'ë™ê´‘ì¤‘í•™êµ', 'ë§¤ì–‘ì¤‘í•™êµ',
      'ìƒì›ì—¬ìì¤‘í•™êµ', 'ì„±ë‚¨ë™ì¤‘í•™êµ', 'ì„±ë‚¨ë¬¸ì›ì¤‘í•™êµ', 'ì„±ë‚¨ì„œì¤‘í•™êµ', 'ì„±ë‚¨ì—¬ìì¤‘í•™êµ',
      'ì„±ë‚¨ì¤‘í•™êµ', 'ì„±ì¼ì¤‘í•™êµ', 'ìˆ˜ì§„ì¤‘í•™êµ', 'ìˆ­ì‹ ì—¬ìì¤‘í•™êµ', 'ì•¼íƒ‘ì¤‘í•™êµ',
      'ì˜ì„±ì¤‘í•™êµ', 'ì€í–‰ì¤‘í•™êµ', 'ìœ„ë¡€ì¤‘ì•™ì¤‘', 'ì°½ì„±ì¤‘í•™êµ', 'ì´ˆì›”ì¤‘í•™êµ',
      'íƒ„ë²Œì¤‘í•™êµ', 'íƒœì „ì¤‘í•™êµ', 'íƒœí‰ì¤‘í•™êµ', 'í’ìƒì¤‘í•™êµ'
    ];
    const schoolSelect = document.getElementById('school');
    middleSchools.forEach(s => {
      const op = document.createElement('option');
      op.textContent = s;
      op.value = s;
      schoolSelect.appendChild(op);
    });

    // âœ… ë°˜ ì„ íƒ (1~20)
    const classSelect = document.getElementById('classSelect');
    for (let i = 1; i <= 20; i++) {
      const op = document.createElement('option');
      op.value = i;
      op.textContent = `${i}ë°˜`;
      classSelect.appendChild(op);
    }

    // âœ… ë²ˆí˜¸ ì„ íƒ (1~25)
    const numberSelect = document.getElementById('numberSelect');
    for (let i = 1; i <= 25; i++) {
      const op = document.createElement('option');
      op.value = i;
      op.textContent = `${i}ë²ˆ`;
      numberSelect.appendChild(op);
    }

    function checkResult() {
      const school = schoolSelect.value;
      const name = document.getElementById("studentName").value.trim();
      const dept = document.getElementById("department").value;
      const classNo = classSelect.value;
      const number = numberSelect.value;

      if (!school || !name || !dept || !classNo || !number)
        return alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

      // âœ… data.jsì— ìˆëŠ” studentData ë°°ì—´ì—ì„œ í•©ê²©ì ì°¾ê¸°
      const found = studentData.find(
        s =>
        s["ì´ë¦„"] === name &&
        s["ì¶œì‹ ì¤‘í•™êµ"] === school &&
        s["ë°˜"] == classNo &&
        s["ë²ˆí˜¸"] == number &&
        s["ì§€ì›í•™ê³¼"] === dept
      );

      if (!found) {
        alert("ëª…ë‹¨ì— ì—†ìŠµë‹ˆë‹¤. ì…ë ¥ ì •ë³´ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.");
        return;
      }

      // âœ… í•©ê²©ìì¼ ê²½ìš° ìˆ˜í—˜í‘œ í‘œì‹œ
      document.getElementById("formBox").style.display = "none";
      document.getElementById("resultBox").style.display = "flex";

      document.getElementById("nameValue").textContent = name;
      document.getElementById("deptValue").textContent = dept;
      document.getElementById("schoolVal").textContent = school;
      document.getElementById("classVal").textContent = `${classNo}ë°˜ ${number}ë²ˆ`;

      startConfetti();
    }

    let isCameraOpening = false; // ì¤‘ë³µ ë°©ì§€ìš© í”Œë˜ê·¸

    function openCamera() {
      if (isCameraOpening) return; // ì´ë¯¸ ì‹¤í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ
      isCameraOpening = true;

      const input = document.getElementById('photoInput');
      input.value = ''; // ê°™ì€ íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥
      input.click();

      // íŒŒì¼ì°½ì´ ì—´ë¦´ ë™ì•ˆ ì´ë²¤íŠ¸ ì ê¸ˆ ìœ ì§€
      setTimeout(() => (isCameraOpening = false), 1000);
    }

    document.getElementById('photoInput').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        const preview = document.getElementById('photoPreview');
        preview.src = ev.target.result;
        preview.style.display = 'block';
        document.getElementById('cameraButton').style.display = 'none';
      };
      reader.readAsDataURL(file);
    });

    document.getElementById('photoArea').addEventListener('click', (e) => {
      e.stopPropagation(); // ë²„ë¸”ë§ ë°©ì§€
      openCamera();
    });

    function saveCard() {
      const card = document.getElementById('cardArea');
      const cameraBtn = document.getElementById('cameraButton');
      const saveBtn = document.querySelector('.save-btn');

      // ğŸ“Œ ë²„íŠ¼ ì„ì‹œ ìˆ¨ê¹€
      cameraBtn.style.display = 'none';
      saveBtn.style.display = 'none';

      setTimeout(() => {
        html2canvas(card, {
          useCORS: true,
          scale: 3,
          backgroundColor: null
        }).then(canvas => {
          const link = document.createElement('a');
          link.download = 'ì„±ì¼ì •ë³´ê³ _í•©ê²©ì¦.png';
          link.href = canvas.toDataURL('image/png');
          link.click();

          // âœ… ìº¡ì²˜ ì™„ë£Œ í›„, ìº¡ì²˜ ë²„íŠ¼ë§Œ ë‹¤ì‹œ ë³´ì´ê¸° (ì‚¬ì§„ì€ ê·¸ëŒ€ë¡œ)
          setTimeout(() => {
            saveBtn.style.display = 'block';
          }, 500);
        });
      }, 300);
    }

    // ğŸ‰ ê½ƒê°€ë£¨
    function startConfetti() {
      const c = document.getElementById("confetti"),
        ctx = c.getContext("2d");
      c.width = innerWidth;
      c.height = innerHeight;
      const colors = ["#e53935", "#0d47a1", "#fdd835", "#43a047"];
      const confetti = Array.from({
        length: 150
      }, () => ({
        x: Math.random() * c.width,
        y: Math.random() * c.height - c.height,
        r: Math.random() * 6 + 4,
        color: colors[Math.floor(Math.random() * colors.length)],
        tilt: Math.random() * 10 - 10,
        d: Math.random() * 50 + 10
      }));

      function draw() {
        ctx.clearRect(0, 0, c.width, c.height);
        confetti.forEach(p => {
          ctx.beginPath();
          ctx.fillStyle = p.color;
          ctx.ellipse(p.x, p.y, p.r, p.r / 2, p.tilt, 0, 2 * Math.PI);
          ctx.fill();
        });
        update();
        requestAnimationFrame(draw);
      }

      function update() {
        confetti.forEach(p => {
          p.y += 2;
          p.x += Math.sin(p.d);
          if (p.y > c.height) {
            p.y = -10;
            p.x = Math.random() * c.width;
          }
        });
      }
      draw();
    }

    window.addEventListener('resize', () => {
      const c = document.getElementById("confetti");
      c.width = innerWidth;
      c.height = innerHeight;
    });
  </script>
</body>

</html>
