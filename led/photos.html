<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Graduation Memories - Aspect Ratio Preserved</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Pretendard:wght@700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Archivo+Black&family=Dongle&family=Gamja+Flower&family=Moirai+One&display=swap');

        body {
            margin: 0 auto; padding: 0;
            width: 860px; height: 1034px;
            overflow: hidden;
            background: url('images/background_p.png') no-repeat center center;
            background-size: cover;
            font-family: 'Pretendard', sans-serif;
            position: relative;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 253, 245, 0.4); 
            z-index: 0;
        }

        #photo-container {
            position: relative;
            width: 860px; height: 1034px;
            z-index: 1;
        }

        .header-title {
            position: absolute;
            top: 40px; width: 100%;
            text-align: center;
            font-family: "Dongle", sans-serif;
            font-size: 50px;
            color: #2c3e50;
            z-index: 1000;
            text-shadow: 2px 2px 10px rgba(255,255,255,0.9);
            pointer-events: none;
        }

        /* 사진 카드 스타일 */
        .stacked-photo {
            position: absolute;
            width: 320px; /* 고정 너비 */
            /* 높이를 고정하지 않고 내용물에 맞춤 */
            padding: 12px 12px 50px 12px; 
            background: white;
            box-shadow: 5px 12px 30px rgba(0,0,0,0.18);
            border-radius: 4px;
            opacity: 0;
            transform: scale(1.3);
            transition: opacity 0.6s ease-out, transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stacked-photo img {
            /* [핵심] 비율 유지 설정 */
            max-width: 100%;
            max-height: 400px; /* 너무 길어지는 것 방지 */
            width: auto;
            height: auto;
            object-fit: contain; /* 영역 안에서 비율 유지하며 전체 보여주기 */
            display: block;
            border-radius: 2px;
        }

        .stacked-photo.active {
            opacity: 1;
            transform: scale(1);
        }

        .stacked-photo.falling {
            opacity: 0;
            transition: transform 1.2s cubic-bezier(0.5, 0, 1, 0.5), opacity 1s ease-in;
        }
    </style>
</head>
<body>

    <h1 class="header-title">우리들의 소중한 기억</h1>
    <div id="photo-container"></div>

<script>
    const TOTAL_PHOTOS = 126; 
    const IMAGE_EXTENSION = 'jpg'; 
    const SHOW_INTERVAL = 1200; 
    const WAIT_BEFORE_CLEAR = 5000; 

    const container = document.getElementById('photo-container');
    let currentIndex = 1;

    function addPhoto() {
        if (currentIndex > TOTAL_PHOTOS) {
            setTimeout(clearPhotos, WAIT_BEFORE_CLEAR);
            return;
        }

        const imgFrame = document.createElement('div');
        imgFrame.className = 'stacked-photo';
        
        const img = document.createElement('img');
        img.src = `photos/${currentIndex}.${IMAGE_EXTENSION}`;
        
        img.onerror = function() {
            imgFrame.remove();
            currentIndex++;
            addPhoto();
        };

        img.onload = function() {
            imgFrame.appendChild(img);
            container.appendChild(imgFrame);

            // 화면을 벗어나지 않게 랜덤 위치 계산 (높이가 가변적이므로 여유있게 계산)
            const padding = 80;
            const randomX = Math.floor(Math.random() * (860 - 320 - padding * 2)) + padding;
            // 이미지 높이를 고려해 하단 여백을 좀 더 줌
            const randomY = Math.floor(Math.random() * (1034 - 450 - padding * 2)) + padding;
            const randomRotate = Math.floor(Math.random() * 40) - 20;

            imgFrame.style.left = `${randomX}px`;
            imgFrame.style.top = `${randomY}px`;
            imgFrame.dataset.rotate = randomRotate;

            setTimeout(() => {
                imgFrame.style.transform = `rotate(${randomRotate}deg) scale(1)`;
                imgFrame.classList.add('active');
            }, 50);

            currentIndex++;
            setTimeout(addPhoto, SHOW_INTERVAL);
        };
    }

    function clearPhotos() {
        const photos = Array.from(document.querySelectorAll('.stacked-photo'));
        const shuffledPhotos = photos.sort(() => Math.random() - 0.5);

        shuffledPhotos.forEach((photo, index) => {
            const delay = Math.random() * 1200; 
            
            setTimeout(() => {
                const currentRotate = parseFloat(photo.dataset.rotate);
                const extraRotate = (Math.random() > 0.5 ? 120 : -120);
                
                // 낙하 시 더 역동적으로 떨어지도록 1200px 이동
                photo.style.transform = `translateY(1200px) rotate(${currentRotate + extraRotate}deg)`;
                photo.classList.add('falling');
            }, delay);
        });

        setTimeout(() => {
            container.innerHTML = '';
            currentIndex = 1;
            addPhoto();
        }, 3500); 
    }

    addPhoto();
</script>

</body>
</html>