<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ì„±ì¼ì •ë³´ê³  ì„±ê³¼ & ì·¨ì—… í˜„í™©</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0d10; --panel:#12161b; --card:#171c22; --text:#e8edf3; --muted:#9fb0c0; --accent:#4cc9f0; --gold:#ffd166;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background: radial-gradient(120% 120% at 50% -10%, #1b2330 0%, #0b0d10 60%, #050608 100%);
      color:var(--text); overflow:hidden;
    }

    /* ì•± ë˜í¼: ì‹¤ì œ ë³´ì´ëŠ” ë†’ì´ ê¸°ë°˜ */
    .app{height: calc(var(--vh, 1vh) * 100); max-width:1080px; margin:0 auto; display:flex; flex-direction:column; gap:12px; padding:14px}
    @supports (height: 100dvh){ .app{ height: 100dvh; } }

    header{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 12px; border-radius:16px; background:rgba(255,255,255,.03); backdrop-filter: blur(6px);
    }
    .title{display:flex; align-items:baseline; gap:10px}
    .title h1{margin:0; font-size: clamp(20px, 3.6vw, 36px)}
    .mob-br{ display:none; }
    .subtitle{color:var(--muted); font-size: clamp(12px, 2.2vw, 18px)}

    .btn{
      border:1px solid rgba(255,255,255,.12);
      background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(0,0,0,.2));
      color:var(--text); border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer;
      min-width:110px; text-align:center;
    }

    .tabs{display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); gap:8px; background:rgba(255,255,255,.04); padding:8px; border-radius:16px;}
    .tab{position: relative; text-align:center; padding:12px 8px; border-radius:12px; font-weight:700; cursor:pointer; border:1px solid transparent; transition: all 1s;}
    .tab.active{background:linear-gradient(180deg, rgba(76,201,240,.25), rgba(76,201,240,.05)); border-color:rgba(76,201,240,.6);}

    .summary{display:flex; gap:10px; flex-wrap:wrap; align-items:center; color:var(--muted)}
    .summary .pill{display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08); font-weight:600}

    .list-wrap{position:relative; flex:1; min-height:0; border-radius:18px; background:var(--panel); overflow:hidden}
    .page{position:absolute; inset:0; padding:14px; display:grid; opacity:0; transform:translateY(8px); transition:opacity .35s, transform .35s}
    .page.active{opacity:1; transform:none}

    .cards{
      height:100%; display:grid; gap:10px; grid-template-columns:1fr;
      grid-template-rows: repeat(var(--rows, 10), 1fr);
    }
    .card{
      display:grid; grid-template-columns:64px 1fr auto; align-items:center; gap:12px;
      padding:12px; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.2));
      border:1px solid rgba(255,255,255,.08);
    }
    .card.placeholder{ visibility:hidden; pointer-events:none; border-color:transparent; background:transparent; }

    /* ê¸°ë³¸ì€ OFF (ì •ì  ìŠ¤íƒ€ì¼ë§Œ) */
    .card.elite-univ::after { animation: none !important; }
    .card.elite-univ { box-shadow: 0 6px 12px rgba(0,0,0,.25); }
    .card.elite-award::after { animation: none !important; }
    .badge.grand::after { animation: none; }

    /* ONì¼ ë•Œë§Œ ì• ë‹ˆë©”ì´ì…˜/ê°•ì¡° íš¨ê³¼ */
    .effects-on .card.elite { animation: glow 2s infinite alternate; }
    .effects-on .card.elite-univ { animation: pulseBlue 3s infinite alternate; }
    .effects-on .card.elite-univ::after { animation: breathe 4s ease-in-out infinite; }
    .effects-on .card.elite-award::after { animation: breathe 4s ease-in-out infinite; }
    .effects-on .badge.grand::after { animation: shimmer 2.4s linear infinite; }

    .card.elite {
      background: linear-gradient(145deg, #ff6b6b, #a61e1e);
      border: 2px solid #ff8787;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.6);
      animation: none;
    }
    @keyframes glow { from { box-shadow: 0 0 10px rgba(255, 0, 0, 0.4);} to { box-shadow: 0 0 20px rgba(255, 0, 0, 0.8);} }

    .card.elite-univ {
      background: linear-gradient(145deg, #4cc9f0, #4361ee);
      border: 2px solid #a0e9ff;
      box-shadow: 0 0 20px rgba(67, 97, 238, 0.6), 0 0 40px rgba(76, 201, 240, 0.4);
      animation: none;
    }
    @keyframes pulseBlue {
      from { box-shadow: 0 0 12px rgba(67, 97, 238, 0.6), 0 0 24px rgba(76, 201, 240, 0.3); }
      to   { box-shadow: 0 0 28px rgba(67, 97, 238, 0.8), 0 0 56px rgba(76, 201, 240, 0.5); }
    }

    .card.elite-univ .meta .line2 { color:#eaf2ff; text-shadow: 0 1px 2px rgba(0,0,0,.35); }

    .card.elite-award {
      background: linear-gradient(145deg, #ffda6a, #f4a261);
      border: 2px solid #e1a200;
      box-shadow: 0 6px 16px rgba(244, 162, 97, .35);
      position: relative; overflow: hidden;
    }
    .card.elite-award .meta .line1,
    .card.elite-award .meta .line2 { color:#fff; text-shadow: 0 1px 2px rgba(0,0,0,.35); }

    @keyframes breathe { 0%,100%{opacity:.14; transform:scale(.98);} 50%{opacity:.32; transform:scale(1);} }

    .avatar{
      width:64px; height:64px; border-radius:14px; display:grid; place-items:center; font-weight:800;
      background:linear-gradient(145deg, #263243, #151b25); color:var(--gold); border:1px solid rgba(255,255,255,.06);
      font-size:20px;
    }
    .meta .line1{font-size: clamp(15px, 2.6vw, 22px); font-weight:800}
    .meta .line2{font-size: clamp(12px, 2.2vw, 16px); color:var(--muted); margin-top:2px}

    .badge{padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); font-weight:800; font-size: clamp(11px, 2vw, 14px)}
    .badge.gold{color:#2d2a00; background:linear-gradient(180deg,#ffd166,#e0b84b)}
    .badge.silver{color:#1f2630; background:linear-gradient(180deg,#dfe6f1,#b6c0cc)}
    .badge.bronze{color:#2a1a00; background:linear-gradient(180deg,#e6a87a,#c78452)}

    .badge.grand{
      position:relative; color:#1f1400;
      background: linear-gradient(180deg,#ffeaa7 0%, #ffd166 55%, #fcbf49 100%);
      border-color:#e6a700; border-width:2px; padding-left:34px;
      box-shadow:0 0 0 1px rgba(255,215,0,.35) inset, 0 8px 18px rgba(252,191,73,.35);
      overflow:hidden;
    }
    .badge.grand::before{ content:"ğŸ‘‘"; position:absolute; left:10px; top:50%; transform:translateY(-50%); font-size:16px; }
    .badge.grand::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.35) 35%, rgba(255,255,255,0) 70%);
      background-size:200% 100%; pointer-events:none; mix-blend-mode: soft-light;
    }

    .badge.elite {
      background: linear-gradient(180deg,#ff6b6b,#c92a2a);
      color: #fff; border: 2px solid #a61e1e; animation: pulse 1.5s infinite;
    }
    @keyframes pulse { 0%{box-shadow:0 0 0 0 rgba(255,107,107,.6);} 70%{box-shadow:0 0 10px 10px rgba(255,107,107,0);} 100%{box-shadow:0 0 0 0 rgba(255,107,107,0);} }
    @keyframes shimmer{ from{background-position:-120% 0;} to{background-position:120% 0;} }

    /* ì·¨ì—… ìœ í˜• */
    .badge.public{background:rgba(51,154,240,.18); color:#cfe8ff; border-color:#2d82d6}
    .badge.corp{background:rgba(173,181,189,.18); color:#f1f3f5; border-color:#8d959c}
    .badge.agency{background:rgba(81,207,102,.18); color:#d9ffe7; border-color:#3aa957}
    .badge.military {color: #f9f9f9; font-weight: 800; border: 1px solid #2e3b13; background:repeating-linear-gradient(45deg,#4b5320 0 10px,#3b3c36 10px 20px,#556b2f 20px 30px,#2f4f2f 30px 40px); background-size: 80px 80px; box-shadow: inset 0 0 4px rgba(0,0,0,.4);}

    /* ë„ì œ ìƒíƒœ */
    .badge.excellent{ background: linear-gradient(180deg, #fff176, #fbc02d); color: #3b2f00; border-color: #f9a825; }
    .badge.apprentice{ background:linear-gradient(180deg,#cddafd,#6ea8fe); color:#0b3c74; border-color:#4682d9; }

    .controls{position:absolute; inset-inline:0; bottom:8px; display:flex; justify-content:center; gap:8px; pointer-events:none}
    .dot{width:10px; height:10px; border-radius:999px; background:rgba(255,255,255,.25); transition:.25s; cursor:pointer; pointer-events:auto;}
    .dot.active{background:var(--accent); transform:scale(1.15)}

    footer{
      margin-top:6px; padding:10px 12px; border-radius:16px; background:rgba(255,255,255,.03); overflow:hidden; min-height:42px;
      padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 10px);
    }
    .ticker{display:flex; gap:20px; white-space:nowrap; position:relative; left:0; animation:marq 22s linear infinite}
    .ticker:hover{animation-play-state:paused}
    @keyframes marq{from{transform:translateX(0)} to{transform:translateX(-50%)}}

    #viewport.fadeout { opacity:0; transition: opacity .35s; }
    #viewport { transition: opacity .35s; }

    .mini-badge{ display:inline-flex; align-items:center; gap:4px; margin-left:6px; margin-top:4px; padding:2px 6px; border-radius:999px; font-size:11px; font-weight:700; line-height:1; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); color:var(--muted); vertical-align:middle; }
    .mini-badge.year{ border-color: rgba(76,201,240,.45); background: rgba(76,201,240,.12); color: #9fdaf3; }
    .mini-badge.agg{ border-color: rgba(255,215,0,.35); background: rgba(255,215,0,.12); color: #ffe38a; }

    /* ë¼ì´íŠ¸ ëª¨ë“œ */
    .light{
      --bg:#f6f8fb; --panel:#ffffff; --card:#ffffff; --text:#0d1b2a; --muted:#536273; --accent:#0077ff;
      background: linear-gradient(180deg, #f7fbff, #eef3f9);
    }
    .light .avatar{background:linear-gradient(145deg, #e9f1ff, #dce6f7)}
    .light .card{background:linear-gradient(180deg, rgba(0,0,0,.02), rgba(0,0,0,.01))}
    .light .badge.public {background: rgba(51,154,240,.15); color: #0b5394; border-color: #2d82d6;}
    .light .badge.corp {background: rgba(173,181,189,.2); color: #343a40; border-color: #8d959c;}
    .light .badge.agency {background: rgba(81,207,102,.2); color: #2b8a3e; border-color: #3aa957;}
    .light .card.elite-univ .meta .line2 { color: var(--muted); text-shadow: none; }
    .light .card.elite-award .meta .line1, .light .card.elite-award .meta .line2 { color: var(--text); text-shadow: none; }
    .light .mini-badge{ border-color: rgba(0,0,0,.08); background: rgba(0,0,0,.04); color:#495057; }
    .light .mini-badge.year{ border-color: rgba(0,119,255,.25); background: rgba(0,119,255,.08); color:#0b66d6; }
    .light .mini-badge.agg{ border-color: rgba(252,191,73,.35); background: rgba(252,191,73,.12); color:#a26900; }

    /* ë°˜ì‘í˜• */
    @media (max-width: 925px) { .mob-br{ display:inline; } }
    @media (max-width: 830px) {
      header { flex-direction: column; align-items: center; text-align: center; padding: 8px 10px; gap: 8px; }
      .btn { padding: 6px 10px; min-width: auto; font-size: 13px; border-radius: 10px; }
    }
    @media (max-width: 480px) {
      .app { padding: 10px; gap: 10px;}
      header { flex-direction: column; align-items: center; text-align: center; padding: 8px 10px; gap: 8px; }
      .mob-br{ display:inline; } 
      .title { display: flex; flex-direction: column; align-items: center; text-align: center; gap: 4px; min-width: auto; }
      .title h1 { font-size: 18px; line-height: 1.2; margin: 0; text-align: center; }
      .subtitle { font-size: 10px; margin: 0; text-align: center; }

      .actions { width: 100%; display: flex; gap: 6px; margin-top: 4px; justify-content: center; align-items: center; flex-wrap: wrap; }
      .btn { padding: 6px 10px; min-width: auto; font-size: 11px; border-radius: 10px; }

      .tabs::-webkit-scrollbar { display: none; }
      .tab {flex: 0 0 auto; padding: 10px; font-size: 14px; }

      .summary { gap: 6px; }
      .summary .pill { padding: 6px 8px; font-size: 12px; }

      .page { padding: 10px; }
      .cards { gap: 6px; }
      .card { grid-template-columns: 48px 1fr auto; padding: 8px 10px; border-radius: 10px; }
      .avatar { width: 48px; height: 48px; font-size: 16px; border-radius: 10px; }
      .meta .line1 { font-size: 15px; line-height: 1.18; }
      .meta .line2 { font-size: 12px; line-height: 1.18; margin-top: 1px; }
      .badge { font-size: 11px; padding: 3px 6px; border-radius: 9px; }
      .controls { bottom: 6px; }
      .dot { width: 8px; height: 8px; }

      footer { padding: 8px 10px; }
      .ticker { gap: 14px; animation-duration: 26s; }
      .mini-badge{ font-size:9px; padding:2px 5px; margin-left:4px; }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="title">
        <h1>ì„±ì¼ì •ë³´ê³  ì„±ê³¼ & ì·¨ì—… í˜„í™©</h1>
        <div class="subtitle" id="period">2025í•™ë…„ë„</div>
      </div>
      <div class="actions">
        <button class="btn" id="fxToggle">âœ¨ íš¨ê³¼ ON</button>
        <button class="btn" id="btnTheme">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
        <button class="btn" id="btnTogglePlay">â¸ï¸ ì¼ì‹œì •ì§€</button>
      </div>
    </header>

    <div class="tabs" role="tablist">
      <div class="tab active" role="tab" id="tab-awards" aria-selected="true">
        ğŸ† ì„±ê³¼<br class="mob-br">(ìˆ˜ìƒÂ·ìê²©ì¦)
        <span class="mini-badge year" title="ì˜¬í•´ ë°ì´í„°">ğŸ—“ 2025</span>
      </div>
      <div class="tab" role="tab" id="tab-jobs" aria-selected="false">
        ğŸ’¼ ì·¨ì—…<br class="mob-br">(ëŒ€ê¸°ì—…Â·ê³µê¸°ì—…)
        <span class="mini-badge year" title="ì˜¬í•´ ë°ì´í„°">ğŸ—“ 2025</span>
      </div>
      <div class="tab" role="tab" id="tab-doje" aria-selected="false">
        ğŸ¢ ë„ì œ<br class="mob-br">(Since 2016)
        <span class="mini-badge agg" title="ëˆ„ì  ë°ì´í„°">âˆ‘ ëˆ„ì </span>
      </div>
      <div class="tab" role="tab" id="tab-nco" aria-selected="false">
        ğŸª– êµ°ì„ê´€<br class="mob-br">(ë¶€ì‚¬ê´€)
        <span class="mini-badge agg" title="ëˆ„ì  ë°ì´í„°">âˆ‘ ëˆ„ì </span>
      </div>
      <div class="tab" role="tab" id="tab-admissions" aria-selected="false">
        ğŸ“ ì§„í•™<br class="mob-br">(ëŒ€í•™)
        <span class="mini-badge agg" title="ëˆ„ì  ë°ì´í„°">âˆ‘ ëˆ„ì </span>
      </div>
    </div>

    <div class="summary" id="summary">
      <div class="pill">ì´ ì¸ì› <strong id="countTotal">0</strong>ëª…</div>
      <div class="pill">í˜ì´ì§€ <strong id="pageInfo">1/1</strong></div>
      <div class="pill" id="extraInfo">ìë™ ì „í™˜ ì¤‘â€¦</div>
    </div>

    <div class="list-wrap" id="viewport">
      <div class="controls" id="dots"></div>
    </div>

    <footer>
      <div class="ticker" id="ticker">
        <span>ğŸ‘ 2025 ê°ì¢… ëŒ€íšŒì—ì„œ ë‹¤ìˆ˜ ì…ìƒ</span><span>â€¢</span>
        <span>ğŸ‰ ê³µê¸°ì—…Â·ëŒ€ê¸°ì—… ì·¨ì—…ìë¥¼ ë§¤ë…„ ê¾¸ì¤€íˆ ë°°ì¶œ</span><span>â€¢</span>
        <span>ğŸ“£ ìì„¸í•œ ë‚´ìš©ì€ í•™êµ í™ˆí˜ì´ì§€ì—ì„œ í™•ì¸</span><span>â€¢</span>
        <span>ğŸ‘ ì„±ì¼ì •ë³´ê³  í•™ìƒ ì—¬ëŸ¬ë¶„ ìë‘ìŠ¤ëŸ½ìŠµë‹ˆë‹¤!</span>

        <span>ğŸ‘ 2025 ê°ì¢… ëŒ€íšŒì—ì„œ ë‹¤ìˆ˜ ì…ìƒ</span><span>â€¢</span>
        <span>ğŸ‰ ê³µê¸°ì—…Â·ëŒ€ê¸°ì—… ì·¨ì—…ìë¥¼ ë§¤ë…„ ê¾¸ì¤€íˆ ë°°ì¶œ</span><span>â€¢</span>
        <span>ğŸ“£ ìì„¸í•œ ëª…ë‹¨ì€ í•™êµ í™ˆí˜ì´ì§€ì—ì„œ í™•ì¸</span><span>â€¢</span>
        <span>ğŸ‘ ì„±ì¼ì •ë³´ê³  í•™ìƒ ì—¬ëŸ¬ë¶„ ìë‘ìŠ¤ëŸ½ìŠµë‹ˆë‹¤!</span>
      </div>
    </footer>
  </div>

  <!-- ì‹¤ì œ ë³´ì´ëŠ” viewport ë†’ì´ë¥¼ CSS ë³€ìˆ˜ë¡œ ì£¼ì… -->
  <script>
    function setVH(){
      const h = (window.visualViewport ? window.visualViewport.height : window.innerHeight) * 0.01;
      document.documentElement.style.setProperty('--vh', `${h}px`);
    }
    setVH();
    window.addEventListener('resize', setVH);
    if (window.visualViewport) window.visualViewport.addEventListener('resize', setVH);
  </script>

  <script src="./data.js?ver=2"></script>
  <script>
    /************ ìœ í‹¸ ************/
    const maskName = (name) => {
      if (!name) return "";
      return String(name).split(/[,\n]+/g).map(n=>{
        const arr=[...n.trim()];
        if(arr.length===2) return arr[0]+"â—‹";
        if(arr.length>=3) return arr[0]+"â—‹"+arr.slice(2).join("");
        return n.trim();
      }).join(", ");
    };
    function countPeople(name){
      if(!name) return 0;
      const m = String(name).match(/ì´\s*([0-9]+)\s*ëª…/);
      if(m) return parseInt(m[1],10);
      return String(name).split(/[,\n]+/g).map(s=>s.trim()).filter(Boolean).length;
    }
    const prizeClass = (p) => {
      if (!p) return "";
      if (p.includes("ëŒ€ìƒ")) return "grand";
      if (p.includes("ê¸ˆ"))   return "gold";
      if (p.includes("ì€"))   return "silver";
      if (p.includes("ë™"))   return "bronze";
      return "";
    };
    const typeClass  = (t) => {
      if (!t) return "";
      if (t.includes("ê³µê¸°ì—…")) return "public";
      if (t.includes("ê³µë‹¨"))   return "agency";
      if (t.includes("êµ°"))     return "military";
      return "corp";
    };
    const statusClass = (s) => s?.includes("ìš°ëŸ‰") ? "excellent" : "apprentice";

    /************ ë°˜ì‘í˜• rows ê³„ì‚° ************/
    function measureRowHeight() {
      const page = document.querySelector('.page.active');
      if (!page) return 110; // fallback
      const cards = page.querySelector('.cards');
      const first = cards?.querySelector('.card:not(.placeholder)');
      if (!cards || !first) return 110;
      const cs = getComputedStyle(cards);
      const gap = parseFloat(cs.rowGap || cs.gap || 0);
      const h = first.getBoundingClientRect().height;
      return h + gap + 2; // ì•ˆì „ ì—¬ìœ 
    }
    function computePageSizeByHeight(availHeightPx){
      const perRow = measureRowHeight();
      const raw = Math.floor(availHeightPx/perRow);
      const minRows = 3, maxRows = 12;
      return Math.max(minRows, Math.min(maxRows, raw));
    }
    function fitRowsToViewport(){
      // ì˜¤ë²„í”Œë¡œìš°ë©´ í•œ ì¤„ì”© ì¤„ì´ë˜, ë§¤ë²ˆ ìƒˆ DOM ê¸°ì¤€ìœ¼ë¡œ ì¬ì¸¡ì •
      let safety = 6;
      while (safety-- > 0) {
        const page = document.querySelector('.page.active');
        const cards = page?.querySelector('.cards');
        if (!cards) break;
        if (cards.scrollHeight <= cards.clientHeight || PAGE_SIZE <= 3) break;
        PAGE_SIZE--;
        render(false); // ìë™ê³„ì‚° OFFë¡œ ì¬ë Œë”
      }
    }

    /************ ìƒíƒœ/ì„¤ì • ************/
    const root = document.body;
    const btnFx = document.getElementById('fxToggle');

    // ê¸°ë³¸ ON
    root.classList.add('effects-on');
    updateFxLabel();
    btnFx.addEventListener('click', ()=>{
      root.classList.toggle('effects-on');
      updateFxLabel();
    });
    function updateFxLabel(){
      btnFx.textContent = root.classList.contains('effects-on') ? 'âœ¨ íš¨ê³¼ ON' : 'âœ¨ íš¨ê³¼ OFF';
    }

    const AUTO_INTERVAL_MS = 6000;
    let PAGE_SIZE = 7;
    let currentTab="awards", pageIndex=0, autoTimer=null, pages=[];
    let isPaused=false;

    const viewport=document.getElementById("viewport");
    const dots=document.getElementById("dots");
    const pageInfo=document.getElementById("pageInfo");
    const countTotal=document.getElementById("countTotal");
    const extraInfo=document.getElementById("extraInfo");

    /************ ìë™ìˆœí™˜ ************/
    const TAB_ORDER = ["awards", "jobs", "doje", "nco", "admissions"];
    function nextAcross(){
      if (pages.length && pageIndex < pages.length - 1) {
        goToPage(pageIndex + 1);
      } else {
        const i = TAB_ORDER.indexOf(currentTab);
        const nextTab = TAB_ORDER[(i + 1) % TAB_ORDER.length];
        setActiveTab(nextTab);
      }
    }

    function getNcoSortKey(cohort){
      if(!cohort) return 999;
      let num = parseInt(cohort.replace(/[^0-9]/g,""), 10);
      if(cohort.includes("ë™ì•„ë¦¬")){ return num - 9; } // 14 -> 5, 15 -> 6
      return num;
    }

    /************ ë Œë” ************/
    const chunk=(arr,size)=>arr.reduce((acc,_,i)=>(i%size?acc:acc.concat([arr.slice(i,i+size)])),[]);

    function render(autoSize = true){
      // 1) ë°ì´í„° ì„ íƒ
      let data =
        currentTab==="awards" ? awards :
        currentTab==="jobs"   ? jobs   :
        currentTab==="doje"   ? doje   :
        currentTab==="nco"    ? nco    :
                                admissions;

      // 2) ë¶€ì‚¬ê´€ ì •ë ¬ (ìµœì‹  ê¸°ìˆ˜ ë¨¼ì €)
      if(currentTab==="nco"){
        data = [...data].sort((a,b)=>getNcoSortKey(b.cohort) - getNcoSortKey(a.cohort));
      }

      // 3) ì´í•© í‘œì‹œ
      const totalCount =
        currentTab==="awards" ? awards.reduce((s,it)=>s+countPeople(it.name),0) :
        currentTab==="doje"   ? doje.reduce((s,it)=>s+countPeople(it.name),0)   :
        currentTab==="nco"    ? data.length :
        currentTab==="admissions" ? admissions.reduce((s,it)=>s + admissionsCountItem(it), 0) :
                                   jobs.length;
      countTotal.textContent=totalCount;

      // 4) ìë™ í–‰ìˆ˜ ê³„ì‚° (autoSizeì¼ ë•Œë§Œ)
      if (autoSize) {
        const rect = viewport.getBoundingClientRect();
        PAGE_SIZE = computePageSizeByHeight(rect.height);
      }

      // 5) í˜ì´ì§€/ì¹´ë“œ ë Œë”
      viewport.innerHTML=""; dots.innerHTML=""; pages=[];
      const groups = chunk(data, PAGE_SIZE);

      groups.forEach((group, idx)=>{
        const filled=group.slice();
        while(filled.length<PAGE_SIZE) filled.push({__placeholder:true});

        const page=document.createElement("div");
        page.className="page"+(idx===0?" active":"");

        const cards=document.createElement("div");
        cards.className="cards";
        cards.style.setProperty("--rows", PAGE_SIZE);

        filled.forEach((item)=>{
          const card=document.createElement("div");
          card.className="card";
          if(item.__placeholder) card.classList.add("placeholder");

          const avatar=document.createElement("div"); avatar.className="avatar";
          const meta=document.createElement("div"); meta.className="meta";
          const line1=document.createElement("div"); line1.className="line1";
          const line2=document.createElement("div"); line2.className="line2";
          const badge=document.createElement("div"); badge.className="badge";

          if(currentTab==="awards"){
            avatar.textContent=item.icon||"ğŸ†";
            line1.innerHTML=item.comp||"";
            line2.innerHTML=item.name?`${maskName(item.name)} Â· ${item.year||""}`:"";
            badge.textContent=item.prize||"";
            badge.className+=" "+(item.prize?prizeClass(item.prize):"");
            if (item.isPremier) card.classList.add("elite-award");
          }
          else if(currentTab==="jobs"){
            avatar.textContent=item.emoji||"ğŸ¢";
            line1.innerHTML=item.company||"";
            line2.innerHTML=(item.dept||"")+" "+(item.name?maskName(item.name):"");
            badge.textContent=item.type||"";
            badge.className+=" "+(item.type?typeClass(item.type):"");
          }
          else if(currentTab==="doje"){
            avatar.textContent="ğŸ§‘ğŸ»â€ğŸ’»";
            line1.innerHTML=item.company||"";
            line2.innerHTML=(item.dept||"")+" "+(item.name?maskName(item.name):"")+" Â· "+(item.year||"")+(item.cohort?`(${item.cohort})`:"");
            badge.textContent=item.status||"";
            badge.className+=" "+(item.status?statusClass(item.status):"");
          }
          else if(currentTab==="nco"){
            avatar.textContent=item.emoji||"ğŸª–";
            line1.innerHTML=item.company||"";
            line2.innerHTML=(item.dept||"")+" "+(item.name?maskName(item.name):"");
            badge.textContent=item.cohort||"";
            badge.className+=" apprentice";
            const eliteUnits=[
              "707íŠ¹ìˆ˜ì„ë¬´ë‹¨","í•´êµ°íŠ¹ìˆ˜ì „ì „ë‹¨(UDT)","í•´ë‚œêµ¬ì¡°ì „ëŒ€(SSU)","ê³µêµ° ì œ259íŠ¹ìˆ˜ì„ë¬´ëŒ€ëŒ€(CCT)","ì œ6íƒìƒ‰êµ¬ì¡°ë¹„í–‰ì „ëŒ€(SART)"
            ];
            if (eliteUnits.some(unit => (item.company||"").includes(unit))) card.classList.add("elite");
          }
          else if(currentTab==="admissions"){
            avatar.textContent="ğŸ“";
            line1.innerHTML=item.univ||"";
            const parts=[]; if(item.major) parts.push(item.major); if(item.track) parts.push(item.track); if(item.name) parts.push(maskName(item.name));
            line2.innerHTML=parts.join(" Â· ");
            badge.textContent=groupDisplay(item.category);
            if (item.category==="4ë…„ì œëŒ€í•™" || item.category==="ì„ ì·¨ì—…í›„ì§„í•™") badge.classList.add("grand");
            if (item.count && !item.name) line2.innerHTML=(line2.innerHTML?line2.innerHTML+" Â· ":"")+`${item.count}ëª…`;
            if (item.isPremier) card.classList.add("elite-univ");
          }

          meta.appendChild(line1); meta.appendChild(line2);
          card.appendChild(avatar); card.appendChild(meta); card.appendChild(badge);
          cards.appendChild(card);
        });

        page.appendChild(cards);
        viewport.appendChild(page);
        pages.push(page);

        const dot=document.createElement("div");
        dot.className="dot"+(idx===0?" active":"");
        dot.addEventListener("click",()=>{ stopAuto(); goToPage(idx); startAuto(); });
        dots.appendChild(dot);
      });

      // 6) ì²« ë Œë” ë’¤ ì˜¤ë²„í”Œë¡œìš° ë³´ì •ì€ autoSizeì¼ ë•Œë§Œ 1íšŒ ìˆ˜í–‰
      if (autoSize) {
        fitRowsToViewport(); // ë‚´ë¶€ì—ì„œ render(false)ë¡œ ì¬ë Œë”í•  ìˆ˜ ìˆìŒ
      }

      // 7) í˜ì´ì§€ UI ê°±ì‹ 
      pageIndex=0;
      updatePageInfo();
      extraInfo.textContent=isPaused?"ì¼ì‹œì •ì§€ë¨":"ìë™ ì „í™˜ ì¤‘â€¦";
    }

    function admissionsCountItem(it){
      if (typeof it.count === "number") return it.count;
      if (it.count && /^\d+$/.test(it.count)) return parseInt(it.count,10);
      if (it.name) return 1;
      return 1;
    }
    function groupDisplay(g){
      if (g==="4ë…„ì œëŒ€í•™") return "4ë…„ì œëŒ€í•™";
      if (g==="ì „ë¬¸ëŒ€")  return "ì „ë¬¸ëŒ€í•™";
      if (g==="ì„ ì·¨ì—…í›„ì§„í•™") return "ì„ ì·¨ì—…í›„ì§„í•™";
      return g||"";
    }

    function updatePageInfo(){
      const total=pages.length||1;
      pageInfo.textContent=`${pageIndex+1}/${total}`;
      [...dots.children].forEach((d,i)=>d.classList.toggle("active",i===pageIndex));
    }
    function goToPage(i){
      if(!pages.length) return;
      pages.forEach((p,idx)=>p.classList.toggle("active", idx===i));
      pageIndex=i; updatePageInfo();
    }
    function nextPage(){ if(pages.length) goToPage((pageIndex+1)%pages.length); }

    function startAuto(){ stopAuto(); if(!isPaused) autoTimer=setInterval(nextAcross, AUTO_INTERVAL_MS); }
    function stopAuto(){ if(autoTimer){ clearInterval(autoTimer); autoTimer=null; } }

    function renderTicker(tabKey){
      const items = tickerTexts[tabKey] || [];
      const ticker = document.getElementById("ticker");
      if(!ticker) return;
      const once = items.map((t,i)=>`<span>${t}</span>${i<items.length-1?'<span>â€¢</span>':''}`).join("");
      ticker.innerHTML = once + once;
    }

    /************ ìƒí˜¸ì‘ìš© ************/
    // ìŠ¤ì™€ì´í”„
    let touchStartY=null;
    const viewportEl=document.getElementById("viewport");
    viewportEl.addEventListener("touchstart", e=>{ touchStartY=e.touches[0].clientY; stopAuto(); extraInfo.textContent="ì¼ì‹œì •ì§€(í„°ì¹˜)"; }, {passive:true});
    viewportEl.addEventListener("touchend", e=>{
      if(touchStartY==null) return;
      const dy=e.changedTouches[0].clientY - touchStartY;
      if(Math.abs(dy)>40){ dy<0 ? nextPage() : goToPage((pageIndex-1+pages.length)%pages.length); }
      touchStartY=null; if(!isPaused){ startAuto(); extraInfo.textContent="ìë™ ì „í™˜ ì¤‘â€¦"; }
    }, {passive:true});

    // íƒ­ ì „í™˜
    document.getElementById("tab-awards").addEventListener("click", ()=>setActiveTab("awards"));
    document.getElementById("tab-jobs").addEventListener("click", ()=>setActiveTab("jobs"));
    document.getElementById("tab-doje").addEventListener("click", ()=>setActiveTab("doje"));
    document.getElementById("tab-nco").addEventListener("click", ()=>setActiveTab("nco"));
    document.getElementById("tab-admissions").addEventListener("click", ()=>setActiveTab("admissions"));
    function setActiveTab(key){
      viewport.classList.add("fadeout");
      setTimeout(()=>{
        currentTab=key;
        document.getElementById("tab-awards").classList.toggle("active", key==="awards");
        document.getElementById("tab-jobs").classList.toggle("active", key==="jobs");
        document.getElementById("tab-doje").classList.toggle("active", key==="doje");
        document.getElementById("tab-nco").classList.toggle("active", key==="nco");
        document.getElementById("tab-admissions").classList.toggle("active", key==="admissions");
        render(true);           // ìë™ ê³„ì‚° ON
        renderTicker(key);
        if(!isPaused) startAuto();
        viewport.classList.remove("fadeout");
      }, 350);
    }

    // í…Œë§ˆ í† ê¸€
    const btnTheme = document.getElementById("btnTheme");
    btnTheme.addEventListener("click", () => {
      document.body.classList.toggle("light");
      btnTheme.textContent = document.body.classList.contains("light") ? "â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ" : "ğŸŒ™ ë‹¤í¬ëª¨ë“œ";
    });

    // ì¼ì‹œì •ì§€/ì¬ìƒ í† ê¸€
    document.getElementById("btnTogglePlay").addEventListener("click", ()=>{
      isPaused = !isPaused;
      if(isPaused){
        stopAuto();
        document.getElementById("btnTogglePlay").textContent="â–¶ï¸ ë‹¤ì‹œì¬ìƒ";
        extraInfo.textContent="ì¼ì‹œì •ì§€ë¨";
      }else{
        document.getElementById("btnTogglePlay").textContent="â¸ï¸ ì¼ì‹œì •ì§€";
        extraInfo.textContent="ìë™ ì „í™˜ ì¤‘â€¦";
        startAuto();
      }
    });

    // ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì¬ê³„ì‚°
    window.addEventListener("resize", ()=>{ render(true); if(!isPaused) startAuto(); });

    // ì´ˆê¸° ë Œë”
    render(true); renderTicker(currentTab); startAuto();
  </script>
</body>
</html>
